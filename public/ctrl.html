<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">
      $(function() {
        var $body = $('body'),
            isDown = false,
            socket = io.connect();

        socket.emit('subscribe', 'controller');
        
        $body.bind('touchstart', touchchange);
        $body.bind('touchmove', touchmove);
        $body.bind('touchend', touchchange);

        function touchchange(e) {
          e.preventDefault();
          var wasDown = isDown;
          isDown = e.originalEvent.targetTouches.length == 2;

          if(isDown) {
            $body.addClass("down");
          }
          else {
            $body.removeClass("down");
          }

          if(isDown) {
            exportTouches(e);
          }
          else if(wasDown) {
            exportNull(e);
          }
        }

        function touchmove(e) {
          e.preventDefault();
          if(isDown) {
            exportTouches(e);
          }
        }

        function exportTouches(e) {
          var points = $.map(e.originalEvent.targetTouches, function(touchPt) {
                return { x: touchPt.pageX, y: touchPt.pageY };
              });

          $body.html(
            $.map(points, function(pt) {
              return '<div>' + pt.x + ',' + pt.y + '</div>';
            }).join('')
          );
          
          socket.emit('pts', points);
        }

        function exportNull(e) {
          $body.html('NO TOUCH');
        }
      });
    </script>
    <style type="text/css">
      html { height:100%; }
      body { height:100%; margin:0; padding:0; background-color: #c00; user-select:none; text-align:center; }
      body.down { background-color:#0c0; }
    </style>
  </head>
  <body>
    &nbsp;
  </body>
</html>